# TCP 소켓 : 클라이언트 와 서버간의 일대일 통신

먼저 서버 프로그램이 실행되어 클라이언트 프로그램의 연결요청을 기다리고 있어야 한다.

서버 프로그램과 클라이언트 프로그램간의 통신과정

1. 서버 프로그램에서는 서버소켓을 사용해서 서버 컴퓨터의 특정 포트에서 클라이언트의 연결요청을 처리할 준비를 한다.
2. 클라이언트 프로그램은 접속할 서버의 IP주소와 포트정보를 가지고 소켓을 생성해서 서버에 연결을 요청한다.
3. 서버소켓은 클라이언트의 연결요청을 받으면 서버에 새로운 소켓을 생성해서 클라이언트의 소켓과 연결되도록 한다.
4. 이제 클라이언트의 소켓과 새로 생성된 서버의 소켓은 서버소켓과 관계없이 일대일 통신을 한다.

서버소켓은 포트와 결합(bind)되어 포트를 통해 원격 사용자의 연결요청을 기다리다가 연결요청이 올 때마다 새로운 소켓을 생성하여 상대편 소켓과 통신할 수 있도록 연결한다.
여기까지가 서버소켓의 역할, 실제적인 데이터 통신은 서버소켓과 관계없이 소켓과 소켓 간에 이루어 진다.

이는 마치 전화시스템과 유사해서 서버소켓은 전화 교환기
소켓은 전화기에 비유할 수 있다.
전화교환기(서버소켓)는 외부전화기(원격소켓)로부터 걸려온 전화를 내부의 전화기(소켓)으로 연결해주고 실제 통화는 전화기(소켓) 대 전화기(원격소켓)끼리 이루어 진다.

여러개의 소켓이 하나의 포트를 공유해서 사용할 수도 있다.
하지만 서버 소켓은 다르다. => 서버 소켓은 포트를 독점 [만일 한 포트를 둘 이상의 서버소켓과 연결이 되면 어떤 서버소켓과 연결이 되어야 하는지 알 수 없다.]

※두 서버소켓이 서로 다른 프로토콜을 사용하는 경우에는 같은 포트를 사용할 수 있다. 포트는 같아도 클라이언트 프로그램이 사용하는 프로토콜로 어떤 서버소켓과 연결되어야 하는지 구별이 가능
그래도 가능하면 하나의 포트는 하나의 서버 소켓만 사용하도록 하는 것이 바람직

포트는 호스트(컴퓨터)가 외부와 통신을 하기 위한 통로 , 하나의 호스트가 65536개의 포트를 가지고 있으며 포트는 번호로 구별

서버소켓은 소켓간의 연결만 처리, 실제 데이터는 소켓들끼리 서로 주고받는다.

소켓은 두개의 스트림 => 입력 스트림, 출력 스트림을 가지고 있다. 그리고 소켓이 연결되면 두 스트림은 서로 상대방의 것과 교차된다.
내 입력은 상대방 출력으로 , 내 출력은 상대방 입력으로

### Socket

프로세스간의 통신을 담당, InputStream 과 OutputStream을 가지고 있다.
이 두 스트림을 통해 프로세스간의 통신(입출력)이 이루어진다.

### ServerSocket

포트와 연결(bind)되어 외부의 연결요청을 기다리다 연결요청이 들어오면, Socket을 생성해서 소켓과 소켓간의 통신이 이루어지도록 한다.
한 포트에 하나의 ServerSocket만 연결
(프로토콜이 다르면 같은 포트를 공유)
